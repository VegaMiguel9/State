{"ast":null,"code":"import React,{useEffect}from'react';import{useQuery}from'@apollo/react-hooks';import ProductItem from\"../ProductItem\";import{QUERY_PRODUCTS}from\"../../utils/queries\";import spinner from\"../../assets/spinner.gif\";import{UPDATE_PRODUCTS}from'../../utils/actions';import{idbPromise}from'../../utils/helpers';import{useDispatch,useSelector}from'react-redux';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ProductList(){var state=useSelector(function(state){return state;});var dispatch=useDispatch();var currentCategory=state.currentCategory;var _useQuery=useQuery(QUERY_PRODUCTS),loading=_useQuery.loading,data=_useQuery.data;var products=(data===null||data===void 0?void 0:data.products)||[];useEffect(function(){//if there is data to be stored\nif(data){dispatch({type:UPDATE_PRODUCTS,products:data.products});// but let's also take each product and save it to IndexedDB using the helper function\ndata.products.forEach(function(product){idbPromise('products','put',product);});// add else if to check if `loading` is undefined in `useQuery()` Hook\n}else if(!loading){//since we are offline, get all if the data from the products store\nidbPromise('products','get').then(function(products){//use retrieved data to set global state for offline browsing\ndispatch({type:UPDATE_PRODUCTS,products:products});});}},[data,loading,dispatch]);function filterProducts(){if(!currentCategory){return state.products;}return state.products.filter(function(product){return product.category._id===currentCategory;});}return/*#__PURE__*/_jsxs(\"div\",{className:\"my-2\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Our Products:\"}),products.length?/*#__PURE__*/_jsx(\"div\",{className:\"flex-row\",children:filterProducts().map(function(product){return/*#__PURE__*/_jsx(ProductItem,{_id:product._id,image:product.image,name:product.name,price:product.price,quantity:product.quantity},product._id);})}):/*#__PURE__*/_jsx(\"h3\",{children:\"You haven't added any products yet!\"}),loading?/*#__PURE__*/_jsx(\"img\",{src:spinner,alt:\"loading\"}):null]});}export default ProductList;","map":{"version":3,"names":["React","useEffect","useQuery","ProductItem","QUERY_PRODUCTS","spinner","UPDATE_PRODUCTS","idbPromise","useDispatch","useSelector","jsx","_jsx","jsxs","_jsxs","ProductList","state","dispatch","currentCategory","_useQuery","loading","data","products","type","forEach","product","then","filterProducts","filter","category","_id","className","children","length","map","image","name","price","quantity","src","alt"],"sources":["/Users/vega/bootcamp/hw/State/client/src/components/ProductList/index.js"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { useQuery } from '@apollo/react-hooks';\nimport ProductItem from \"../ProductItem\";\nimport { QUERY_PRODUCTS } from \"../../utils/queries\";\nimport spinner from \"../../assets/spinner.gif\"\nimport { UPDATE_PRODUCTS } from '../../utils/actions';\nimport { idbPromise } from '../../utils/helpers';\nimport { useDispatch, useSelector } from 'react-redux';\n\n\nfunction ProductList() {\n\n\n  const state = useSelector((state) => {\n    return state\n  });\n  const dispatch = useDispatch();\n\n  const { currentCategory } = state;\n  \n  const { loading, data } = useQuery(QUERY_PRODUCTS);\n\n  const products = data?.products || [];\n  \n  useEffect(() => {\n    //if there is data to be stored\n    if (data) {\n      dispatch({\n        type: UPDATE_PRODUCTS,\n        products: data.products\n      });\n      // but let's also take each product and save it to IndexedDB using the helper function\n      data.products.forEach((product) => {\n        idbPromise('products', 'put', product)\n      });\n\n      // add else if to check if `loading` is undefined in `useQuery()` Hook\n  \n    } else if (!loading) {\n      //since we are offline, get all if the data from the products store\n\n      idbPromise('products', 'get').then((products) => {\n        //use retrieved data to set global state for offline browsing\n        dispatch({\n          type: UPDATE_PRODUCTS,\n          products: products\n        })\n      })\n    }\n  }, [data, loading, dispatch]);\n\n  \n  function filterProducts() {\n    if (!currentCategory) {\n      return state.products;\n    }\n  \n    return state.products.filter(product => product.category._id === currentCategory);\n  }\n\n\n  return (\n    <div className=\"my-2\">\n      <h2>Our Products:</h2>\n      {products.length ? (\n        <div className=\"flex-row\">\n            {filterProducts().map(product => (\n                <ProductItem\n                  key= {product._id}\n                  _id={product._id}\n                  image={product.image}\n                  name={product.name}\n                  price={product.price}\n                  quantity={product.quantity}\n                />\n            ))}\n        </div>\n      ) : (\n        <h3>You haven't added any products yet!</h3>\n      )}\n      { loading ? \n      <img src={spinner} alt=\"loading\" />: null}\n    </div>\n  );\n}\n\nexport default ProductList;"],"mappings":"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"},"metadata":{},"sourceType":"module"}