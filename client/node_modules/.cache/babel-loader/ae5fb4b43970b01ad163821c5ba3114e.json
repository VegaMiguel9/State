{"ast":null,"code":"var _jsxFileName = \"/Users/vega/bootcamp/hw/State/client/src/components/Cart/index.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect } from 'react';\nimport CartItem from '../CartItem';\nimport Auth from '../../utils/auth';\nimport './style.css';\nimport { TOGGLE_CART, ADD_MULTIPLE_TO_CART } from '../../utils/actions';\nimport { idbPromise } from '../../utils/helpers';\nimport { QUERY_CHECKOUT } from '../../utils/queries';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { useLazyQuery } from '@apollo/react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe('pk_test_TYooMQauvdEDq54NiTphI7jx');\nconst Cart = () => {\n  _s();\n  const state = useSelector(state => {\n    return state;\n  });\n  const dispatch = useDispatch();\n  const [getCheckout, {\n    data\n  }] = useLazyQuery(QUERY_CHECKOUT);\n  useEffect(() => {\n    async function getCart() {\n      const cart = await idbPromise('cart', 'get');\n      dispatch({\n        type: ADD_MULTIPLE_TO_CART,\n        products: [...cart]\n      });\n    }\n    ;\n    if (!state.cart.length) {\n      getCart();\n    }\n  }, [state.cart.length, dispatch]);\n  function toggleCart() {\n    dispatch({\n      type: TOGGLE_CART\n    });\n  }\n  function calculateTotal() {\n    let sum = 0;\n    state.cart.forEach(item => {\n      sum += item.price * item.purchaseQuantity;\n    });\n    return sum.toFixed(2);\n  }\n  function submitCheckout() {\n    const productIds = [];\n    state.cart.forEach(item => {\n      for (let i = 0; i < item.purchaseQuantity; i++) {\n        productIds.push(item._id);\n      }\n    });\n    getCheckout({\n      variables: {\n        products: productIds\n      }\n    });\n  }\n  useEffect(() => {\n    if (data) {\n      stripePromise.then(res => {\n        res.redirectToCheckout({\n          sessionId: data.checkout.session\n        });\n      });\n    }\n  }, [data]);\n  if (!state.cartOpen) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cart-closed\",\n      onClick: toggleCart,\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        role: \"img\",\n        \"aria-label\": \"trash\",\n        children: \"\\uD83D\\uDED2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 15\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 13\n    }, this);\n  }\n  console.log(state);\n  return (\n    /*#__PURE__*/\n    // <div className=\"cart\">\n    //   <div className=\"close\" onClick={toggleCart}>[close]</div>\n    //   <h2>Shopping Cart</h2>\n    //   <div>\n    //       <CartItem item={{name:'Camera', image:'camera.jpg', price:5, purchaseQuantity:3}} />\n    //       <CartItem item={{name:'Soap', image:'soap.jpg', price:6, purchaseQuantity:4}} />\n    //       <div className=\"flex-row space-between\">\n    //         <strong>Total: $0</strong>\n    //         {\n    //           Auth.loggedIn() ?\n    //             <button>\n    //               Checkout\n    //             </button>\n    //             :\n    //             <span>(log in to check out)</span>\n    //         }\n    //       </div>\n    //     </div>\n    // </div>\n    _jsxDEV(\"div\", {\n      className: \"cart\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"close\",\n        onClick: toggleCart,\n        children: \"[close]\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 3\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Shopping Cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 3\n      }, this), state.cart.length ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [state.cart.map(item => /*#__PURE__*/_jsxDEV(CartItem, {\n          item: item\n        }, item._id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 9\n        }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-row space-between\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: [\"Total: $\", calculateTotal()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 9\n          }, this), Auth.loggedIn() ? /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: submitCheckout,\n            children: \"Checkout\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 125,\n            columnNumber: 13\n          }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"(log in to check out)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 7\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 5\n      }, this) : /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          role: \"img\",\n          \"aria-label\": \"shocked\",\n          children: \"\\uD83D\\uDE31\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 7\n        }, this), \"You haven't added anything to your cart yet!\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 5\n    }, this)\n  );\n};\n_s(Cart, \"kN+SSnE2x55oKaLE+x5vmv79Oi4=\", false, function () {\n  return [useSelector, useDispatch, useLazyQuery];\n});\n_c = Cart;\nexport default Cart;\nvar _c;\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"names":["React","useEffect","CartItem","Auth","TOGGLE_CART","ADD_MULTIPLE_TO_CART","idbPromise","QUERY_CHECKOUT","loadStripe","useLazyQuery","useDispatch","useSelector","jsxDEV","_jsxDEV","stripePromise","Cart","_s","state","dispatch","getCheckout","data","getCart","cart","type","products","length","toggleCart","calculateTotal","sum","forEach","item","price","purchaseQuantity","toFixed","submitCheckout","productIds","i","push","_id","variables","then","res","redirectToCheckout","sessionId","checkout","session","cartOpen","className","onClick","children","role","fileName","_jsxFileName","lineNumber","columnNumber","console","log","map","loggedIn","_c","$RefreshReg$"],"sources":["/Users/vega/bootcamp/hw/State/client/src/components/Cart/index.js"],"sourcesContent":["import React, { useEffect } from 'react';\nimport CartItem from '../CartItem';\nimport Auth from '../../utils/auth';\nimport './style.css';\nimport { TOGGLE_CART, ADD_MULTIPLE_TO_CART } from '../../utils/actions';\nimport { idbPromise } from '../../utils/helpers';\nimport { QUERY_CHECKOUT } from '../../utils/queries';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { useLazyQuery } from '@apollo/react';\nimport { useDispatch, useSelector } from 'react-redux';\n\n\nconst stripePromise = loadStripe('pk_test_TYooMQauvdEDq54NiTphI7jx');\n\nconst Cart = () => {\n\n    const state = useSelector((state) => {\n      return state\n    });\n\n    const dispatch = useDispatch();\n\n    const [getCheckout, {data}] = useLazyQuery(QUERY_CHECKOUT);\n\n    useEffect(() => {\n        async function getCart() {\n            const cart = await idbPromise('cart', 'get');\n            dispatch({\n                type: ADD_MULTIPLE_TO_CART,\n                products: [...cart]\n            })\n        };\n\n        if(!state.cart.length) {\n            getCart();\n        }\n    }, [state.cart.length, dispatch]);\n\n\n\n    function toggleCart() {\n        dispatch({type: TOGGLE_CART});\n    }\n\n    function calculateTotal() {\n        let sum = 0;\n        state.cart.forEach(item => {\n            sum+= item.price * item.purchaseQuantity;\n        })\n\n        return sum.toFixed(2);\n    }\n\n\n    function submitCheckout() {\n        const productIds = [];\n\n        state.cart.forEach((item) => {\n            for (let i=0; i<item.purchaseQuantity; i++) {\n                productIds.push(item._id);\n            }\n        })\n\n        getCheckout({\n            variables: {products: productIds}\n        })\n    }\n\n\n    useEffect(() => {\n        if(data) {\n            stripePromise.then((res) => {\n                res.redirectToCheckout({ sessionId: data.checkout.session})\n            })\n        }\n    }, [data])\n    \n\n    if(!state.cartOpen) {\n        return (\n            <div className=\"cart-closed\" onClick={toggleCart}>\n              <span\n                role=\"img\"\n                aria-label=\"trash\">ðŸ›’</span>\n            </div>\n          );\n    }\n\n    console.log(state);\n\n\n  return (\n    // <div className=\"cart\">\n    //   <div className=\"close\" onClick={toggleCart}>[close]</div>\n    //   <h2>Shopping Cart</h2>\n    //   <div>\n    //       <CartItem item={{name:'Camera', image:'camera.jpg', price:5, purchaseQuantity:3}} />\n    //       <CartItem item={{name:'Soap', image:'soap.jpg', price:6, purchaseQuantity:4}} />\n\n    //       <div className=\"flex-row space-between\">\n    //         <strong>Total: $0</strong>\n    //         {\n    //           Auth.loggedIn() ?\n    //             <button>\n    //               Checkout\n    //             </button>\n    //             :\n    //             <span>(log in to check out)</span>\n    //         }\n    //       </div>\n    //     </div>\n    // </div>\n    <div className=\"cart\">\n  <div className=\"close\" onClick={toggleCart}>[close]</div>\n  <h2>Shopping Cart</h2>\n  {state.cart.length ? (\n    <div>\n      {state.cart.map(item => (\n        <CartItem key={item._id} item={item} />\n      ))}\n      <div className=\"flex-row space-between\">\n        <strong>Total: ${calculateTotal()}</strong>\n        {\n          Auth.loggedIn() ?\n            <button onClick={submitCheckout}>\n              Checkout\n            </button>\n            :\n            <span>(log in to check out)</span>\n        }\n      </div>\n    </div>\n  ) : (\n    <h3>\n      <span role=\"img\" aria-label=\"shocked\">\n        ðŸ˜±\n      </span>\n      You haven't added anything to your cart yet!\n    </h3>\n  )}\n</div>\n  );\n};\n\nexport default Cart;"],"mappings":"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"},"metadata":{},"sourceType":"module"}